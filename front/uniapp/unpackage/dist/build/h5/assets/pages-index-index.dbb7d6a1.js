import{g as t,r as i,o as e,c as o,w as s,n,a,b as r,d as l,e as c,F as h,f as u,h as d,t as p,i as f,j as m,k as g,l as y,m as b,p as k,q as w,s as T,u as C,v as _,x as v,y as S,z as x,M as I}from"./index-d86fb874.js";import{_ as P,r as A,a as E}from"./uni-app.es.929e2abd.js";import{_ as $,a as B}from"./uni-list.51fc99f0.js";const D=P({name:"UniFab",emits:["fabClick","trigger"],props:{pattern:{type:Object,default:()=>({})},horizontal:{type:String,default:"left"},vertical:{type:String,default:"bottom"},direction:{type:String,default:"horizontal"},content:{type:Array,default:()=>[]},show:{type:Boolean,default:!1},popMenu:{type:Boolean,default:!0}},data:()=>({fabShow:!1,isShow:!1,isAndroidNvue:!1,styles:{color:"#3c3e49",selectedColor:"#007AFF",backgroundColor:"#fff",buttonColor:"#007AFF",iconColor:"#fff"}}),computed:{contentWidth(t){return 55*(this.content.length+1)+15+"px"},contentWidthMin:()=>"55px",boxWidth(){return this.getPosition(3,"horizontal")},boxHeight(){return this.getPosition(3,"vertical")},leftBottom(){return this.getPosition(0,"left","bottom")},rightBottom(){return this.getPosition(0,"right","bottom")},leftTop(){return this.getPosition(0,"left","top")},rightTop(){return this.getPosition(0,"right","top")},flexDirectionStart(){return this.getPosition(1,"vertical","top")},flexDirectionEnd(){return this.getPosition(1,"vertical","bottom")},horizontalLeft(){return this.getPosition(2,"horizontal","left")},horizontalRight(){return this.getPosition(2,"horizontal","right")},nvueBottom:()=>(t().windowBottom,30)},watch:{pattern:{handler(t,i){this.styles=Object.assign({},this.styles,t)},deep:!0}},created(){this.isShow=this.show,0===this.top&&(this.fabShow=!0),this.styles=Object.assign({},this.styles,this.pattern)},methods:{_onClick(){this.$emit("fabClick"),this.popMenu&&(this.isShow=!this.isShow)},open(){this.isShow=!0},close(){this.isShow=!1},_onItemClick(t,i){this.$emit("trigger",{index:t,item:i})},getPosition(t,i,e){return 0===t?this.horizontal===i&&this.vertical===e:1===t?this.direction===i&&this.vertical===e:2===t?this.direction===i&&this.horizontal===e:this.isShow&&this.direction===i?this.contentWidth:this.contentWidthMin}}},[["render",function(t,y,b,k,w,T){const C=f,_=m,v=g,S=A(i("uni-icons"),E);return e(),o(C,{class:"uni-cursor-point"},{default:s((()=>[b.popMenu&&(T.leftBottom||T.rightBottom||T.leftTop||T.rightTop)&&b.content.length>0?(e(),o(C,{key:0,class:n([{"uni-fab--leftBottom":T.leftBottom,"uni-fab--rightBottom":T.rightBottom,"uni-fab--leftTop":T.leftTop,"uni-fab--rightTop":T.rightTop},"uni-fab"]),style:a(T.nvueBottom)},{default:s((()=>[r(C,{class:n([{"uni-fab__content--left":"left"===b.horizontal,"uni-fab__content--right":"right"===b.horizontal,"uni-fab__content--flexDirection":"vertical"===b.direction,"uni-fab__content--flexDirectionStart":T.flexDirectionStart,"uni-fab__content--flexDirectionEnd":T.flexDirectionEnd,"uni-fab__content--other-platform":!w.isAndroidNvue},"uni-fab__content"]),style:a({width:T.boxWidth,height:T.boxHeight,backgroundColor:w.styles.backgroundColor}),elevation:"5"},{default:s((()=>[T.flexDirectionStart||T.horizontalLeft?(e(),o(C,{key:0,class:"uni-fab__item uni-fab__item--first"})):l("",!0),(e(!0),c(h,null,u(b.content,((t,i)=>(e(),o(C,{key:i,class:n([{"uni-fab__item--active":w.isShow},"uni-fab__item"]),onClick:e=>T._onItemClick(i,t)},{default:s((()=>[r(_,{src:t.active?t.selectedIconPath:t.iconPath,class:"uni-fab__item-image",mode:"aspectFit"},null,8,["src"]),r(v,{class:"uni-fab__item-text",style:a({color:t.active?w.styles.selectedColor:w.styles.color})},{default:s((()=>[d(p(t.text),1)])),_:2},1032,["style"])])),_:2},1032,["class","onClick"])))),128)),T.flexDirectionEnd||T.horizontalRight?(e(),o(C,{key:1,class:"uni-fab__item uni-fab__item--first"})):l("",!0)])),_:1},8,["class","style"])])),_:1},8,["class","style"])):l("",!0),r(C,{class:n([{"uni-fab__circle--leftBottom":T.leftBottom,"uni-fab__circle--rightBottom":T.rightBottom,"uni-fab__circle--leftTop":T.leftTop,"uni-fab__circle--rightTop":T.rightTop,"uni-fab__content--other-platform":!w.isAndroidNvue},"uni-fab__circle uni-fab__plus"]),style:a({"background-color":w.styles.buttonColor,bottom:T.nvueBottom}),onClick:T._onClick},{default:s((()=>[r(S,{class:n(["fab-circle-icon",{"uni-fab__plus--active":w.isShow&&b.content.length>0}]),type:"plusempty",color:w.styles.iconColor,size:"32"},null,8,["color","class"])])),_:1},8,["class","style","onClick"])])),_:1})}],["__scopeId","data-v-4ac40f92"]]);class L{constructor(t,i){this.options=t,this.animation=y(t),this.currentStepAnimates={},this.next=0,this.$=i}_nvuePushAnimates(t,i){let e=this.currentStepAnimates[this.next],o={};if(o=e||{styles:{},config:{}},z.includes(t)){o.styles.transform||(o.styles.transform="");let e="";"rotate"===t&&(e="deg"),o.styles.transform+=`${t}(${i+e}) `}else o.styles[t]=`${i}`;this.currentStepAnimates[this.next]=o}_animateRun(t={},i={}){let e=this.$.$refs.ani.ref;if(e)return new Promise(((o,s)=>{nvueAnimation.transition(e,{styles:t,...i},(t=>{o()}))}))}_nvueNextAnimate(t,i=0,e){let o=t[i];if(o){let{styles:s,config:n}=o;this._animateRun(s,n).then((()=>{i+=1,this._nvueNextAnimate(t,i,e)}))}else this.currentStepAnimates={},"function"==typeof e&&e(),this.isEnd=!0}step(t={}){return this.animation.step(t),this}run(t){this.$.animationData=this.animation.export(),this.$.timer=setTimeout((()=>{"function"==typeof t&&t()}),this.$.durationTime)}}const z=["matrix","matrix3d","rotate","rotate3d","rotateX","rotateY","rotateZ","scale","scale3d","scaleX","scaleY","scaleZ","skew","skewX","skewY","translate","translate3d","translateX","translateY","translateZ"];function N(t,i){if(i)return clearTimeout(i.timer),new L(t,i)}z.concat(["opacity","backgroundColor"],["width","height","left","right","top","bottom"]).forEach((t=>{L.prototype[t]=function(...i){return this.animation[t](...i),this}}));const O=P({name:"uniTransition",emits:["click","change"],props:{show:{type:Boolean,default:!1},modeClass:{type:[Array,String],default:()=>"fade"},duration:{type:Number,default:300},styles:{type:Object,default:()=>({})},customClass:{type:String,default:""}},data:()=>({isShow:!1,transform:"",opacity:1,animationData:{},durationTime:300,config:{}}),watch:{show:{handler(t){t?this.open():this.isShow&&this.close()},immediate:!0}},computed:{stylesObject(){let t={...this.styles,"transition-duration":this.duration/1e3+"s"},i="";for(let e in t){i+=this.toLine(e)+":"+t[e]+";"}return i},transformStyles(){return"transform:"+this.transform+";opacity:"+this.opacity+";"+this.stylesObject}},created(){this.config={duration:this.duration,timingFunction:"ease",transformOrigin:"50% 50%",delay:0},this.durationTime=this.duration},methods:{init(t={}){t.duration&&(this.durationTime=t.duration),this.animation=N(Object.assign(this.config,t),this)},onClick(){this.$emit("click",{detail:this.isShow})},step(t,i={}){if(this.animation){for(let i in t)try{"object"==typeof t[i]?this.animation[i](...t[i]):this.animation[i](t[i])}catch(e){console.error(`方法 ${i} 不存在`)}return this.animation.step(i),this}},run(t){this.animation&&this.animation.run(t)},open(){clearTimeout(this.timer),this.transform="",this.isShow=!0;let{opacity:t,transform:i}=this.styleInit(!1);void 0!==t&&(this.opacity=t),this.transform=i,this.$nextTick((()=>{this.timer=setTimeout((()=>{this.animation=N(this.config,this),this.tranfromInit(!1).step(),this.animation.run(),this.$emit("change",{detail:this.isShow})}),20)}))},close(t){this.animation&&this.tranfromInit(!0).step().run((()=>{this.isShow=!1,this.animationData=null,this.animation=null;let{opacity:t,transform:i}=this.styleInit(!1);this.opacity=t||1,this.transform=i,this.$emit("change",{detail:this.isShow})}))},styleInit(t){let i={transform:""},e=(t,e)=>{"fade"===e?i.opacity=this.animationType(t)[e]:i.transform+=this.animationType(t)[e]+" "};return"string"==typeof this.modeClass?e(t,this.modeClass):this.modeClass.forEach((i=>{e(t,i)})),i},tranfromInit(t){let i=(t,i)=>{let e=null;"fade"===i?e=t?0:1:(e=t?"-100%":"0","zoom-in"===i&&(e=t?.8:1),"zoom-out"===i&&(e=t?1.2:1),"slide-right"===i&&(e=t?"100%":"0"),"slide-bottom"===i&&(e=t?"100%":"0")),this.animation[this.animationMode()[i]](e)};return"string"==typeof this.modeClass?i(t,this.modeClass):this.modeClass.forEach((e=>{i(t,e)})),this.animation},animationType:t=>({fade:t?1:0,"slide-top":`translateY(${t?"0":"-100%"})`,"slide-right":`translateX(${t?"0":"100%"})`,"slide-bottom":`translateY(${t?"0":"100%"})`,"slide-left":`translateX(${t?"0":"-100%"})`,"zoom-in":`scaleX(${t?1:.8}) scaleY(${t?1:.8})`,"zoom-out":`scaleX(${t?1:1.2}) scaleY(${t?1:1.2})`}),animationMode:()=>({fade:"opacity","slide-top":"translateY","slide-right":"translateX","slide-bottom":"translateY","slide-left":"translateX","zoom-in":"scale","zoom-out":"scale"}),toLine:t=>t.replace(/([A-Z])/g,"-$1").toLowerCase()}},[["render",function(t,i,r,c,h,u){const d=f;return h.isShow?(e(),o(d,{key:0,ref:"ani",animation:h.animationData,class:n(r.customClass),style:a(u.transformStyles),onClick:u.onClick},{default:s((()=>[b(t.$slots,"default")])),_:3},8,["animation","class","style","onClick"])):l("",!0)}]]);const M=P({name:"uniPopup",components:{keypress:{name:"Keypress",props:{disable:{type:Boolean,default:!1}},mounted(){const t={esc:["Esc","Escape"],tab:"Tab",enter:"Enter",space:[" ","Spacebar"],up:["Up","ArrowUp"],left:["Left","ArrowLeft"],right:["Right","ArrowRight"],down:["Down","ArrowDown"],delete:["Backspace","Delete","Del"]};document.addEventListener("keyup",(i=>{if(this.disable)return;const e=Object.keys(t).find((e=>{const o=i.key,s=t[e];return s===o||Array.isArray(s)&&s.includes(o)}));e&&setTimeout((()=>{this.$emit(e,{})}),0)}))},render:()=>{}}},emits:["change","maskClick"],props:{animation:{type:Boolean,default:!0},type:{type:String,default:"center"},isMaskClick:{type:Boolean,default:null},maskClick:{type:Boolean,default:null},backgroundColor:{type:String,default:"none"},safeArea:{type:Boolean,default:!0},maskBackgroundColor:{type:String,default:"rgba(0, 0, 0, 0.4)"}},watch:{type:{handler:function(t){this.config[t]&&this[this.config[t]](!0)},immediate:!0},isDesktop:{handler:function(t){this.config[t]&&this[this.config[this.type]](!0)},immediate:!0},maskClick:{handler:function(t){this.mkclick=t},immediate:!0},isMaskClick:{handler:function(t){this.mkclick=t},immediate:!0},showPopup(t){document.getElementsByTagName("body")[0].style.overflow=t?"hidden":"visible"}},data(){return{duration:300,ani:[],showPopup:!1,showTrans:!1,popupWidth:0,popupHeight:0,config:{top:"top",bottom:"bottom",center:"center",left:"left",right:"right",message:"top",dialog:"center",share:"bottom"},maskClass:{position:"fixed",bottom:0,top:0,left:0,right:0,backgroundColor:"rgba(0, 0, 0, 0.4)"},transClass:{position:"fixed",left:0,right:0},maskShow:!0,mkclick:!0,popupstyle:this.isDesktop?"fixforpc-top":"top"}},computed:{isDesktop(){return this.popupWidth>=500&&this.popupHeight>=500},bg(){return""===this.backgroundColor||"none"===this.backgroundColor?"transparent":this.backgroundColor}},mounted(){(()=>{const{windowWidth:i,windowHeight:e,windowTop:o,safeArea:s,screenHeight:n,safeAreaInsets:a}=t();this.popupWidth=i,this.popupHeight=e+(o||0),s&&this.safeArea?this.safeAreaInsets=a.bottom:this.safeAreaInsets=0})()},unmounted(){this.setH5Visible()},created(){null===this.isMaskClick&&null===this.maskClick?this.mkclick=!0:this.mkclick=null!==this.isMaskClick?this.isMaskClick:this.maskClick,this.animation?this.duration=300:this.duration=0,this.messageChild=null,this.clearPropagation=!1,this.maskClass.backgroundColor=this.maskBackgroundColor},methods:{setH5Visible(){document.getElementsByTagName("body")[0].style.overflow="visible"},closeMask(){this.maskShow=!1},disableMask(){this.mkclick=!1},clear(t){t.stopPropagation(),this.clearPropagation=!0},open(t){this.showPopup&&(clearTimeout(this.timer),this.showPopup=!1);t&&-1!==["top","center","bottom","left","right","message","dialog","share"].indexOf(t)||(t=this.type),this.config[t]?(this[this.config[t]](),this.$emit("change",{show:!0,type:t})):console.error("缺少类型：",t)},close(t){this.showTrans=!1,this.$emit("change",{show:!1,type:this.type}),clearTimeout(this.timer),this.timer=setTimeout((()=>{this.showPopup=!1}),300)},touchstart(){this.clearPropagation=!1},onTap(){this.clearPropagation?this.clearPropagation=!1:(this.$emit("maskClick"),this.mkclick&&this.close())},top(t){this.popupstyle=this.isDesktop?"fixforpc-top":"top",this.ani=["slide-top"],this.transClass={position:"fixed",left:0,right:0,backgroundColor:this.bg},t||(this.showPopup=!0,this.showTrans=!0,this.$nextTick((()=>{this.messageChild&&"message"===this.type&&this.messageChild.timerClose()})))},bottom(t){this.popupstyle="bottom",this.ani=["slide-bottom"],this.transClass={position:"fixed",left:0,right:0,bottom:0,paddingBottom:this.safeAreaInsets+"px",backgroundColor:this.bg},t||(this.showPopup=!0,this.showTrans=!0)},center(t){this.popupstyle="center",this.ani=["zoom-out","fade"],this.transClass={position:"fixed",display:"flex",flexDirection:"column",bottom:0,left:0,right:0,top:0,justifyContent:"center",alignItems:"center"},t||(this.showPopup=!0,this.showTrans=!0)},left(t){this.popupstyle="left",this.ani=["slide-left"],this.transClass={position:"fixed",left:0,bottom:0,top:0,backgroundColor:this.bg,display:"flex",flexDirection:"column"},t||(this.showPopup=!0,this.showTrans=!0)},right(t){this.popupstyle="right",this.ani=["slide-right"],this.transClass={position:"fixed",bottom:0,right:0,top:0,backgroundColor:this.bg,display:"flex",flexDirection:"column"},t||(this.showPopup=!0,this.showTrans=!0)}}},[["render",function(t,c,h,u,d,p){const m=A(i("uni-transition"),O),g=f,y=k("keypress");return d.showPopup?(e(),o(g,{key:0,class:n(["uni-popup",[d.popupstyle,p.isDesktop?"fixforpc-z-index":""]])},{default:s((()=>[r(g,{onTouchstart:p.touchstart},{default:s((()=>[d.maskShow?(e(),o(m,{key:"1",name:"mask","mode-class":"fade",styles:d.maskClass,duration:d.duration,show:d.showTrans,onClick:p.onTap},null,8,["styles","duration","show","onClick"])):l("",!0),r(m,{key:"2","mode-class":d.ani,name:"content",styles:d.transClass,duration:d.duration,show:d.showTrans,onClick:p.onTap},{default:s((()=>[r(g,{class:n(["uni-popup__wrapper",[d.popupstyle]]),style:a({backgroundColor:p.bg}),onClick:p.clear},{default:s((()=>[b(t.$slots,"default",{},void 0,!0)])),_:3},8,["style","class","onClick"])])),_:3},8,["mode-class","styles","duration","show","onClick"])])),_:3},8,["onTouchstart"]),d.maskShow?(e(),o(y,{key:0,onEsc:p.onTap},null,8,["onEsc"])):l("",!0)])),_:3},8,["class"])):l("",!0)}],["__scopeId","data-v-dd488718"]]);const R={getCurrentPosition:function(t,i){navigator.geolocation?navigator.geolocation.getCurrentPosition((function(i){const e={latitude:i.coords.latitude,longitude:i.coords.longitude};"function"==typeof t&&t(e)}),(function(t){var e="Error: The Geolocation service failed.";switch(t.code){case t.PERMISSION_DENIED:e="User denied the request for Geolocation.";break;case t.POSITION_UNAVAILABLE:e="Location information is unavailable.";break;case t.TIMEOUT:e="The request to get user location timed out.";break;case t.UNKNOWN_ERROR:e="An unknown error occurred."}"function"==typeof i&&i(e)})):"function"==typeof i&&i("Error: Your browser doesn't support geolocation.")},watchPosition:function(t,i){navigator.geolocation?navigator.geolocation.watchPosition((function(i){const e={latitude:i.coords.latitude,longitude:i.coords.longitude};"function"==typeof t&&t(e)}),(function(t){var e="Error: The Geolocation service failed.";switch(t.code){case t.PERMISSION_DENIED:e="User denied the request for Geolocation.";break;case t.POSITION_UNAVAILABLE:e="Location information is unavailable.";break;case t.TIMEOUT:e="The request to get user location timed out.";break;case t.UNKNOWN_ERROR:e="An unknown error occurred."}"function"==typeof i&&i(e)})):"function"==typeof i&&i("Error: Your browser doesn't support geolocation.")}};const j=P({data:()=>({scale:3,popupInfo:{},reginTimerId:0,showTimerId:0,fab:{pattern:{color:"#7A7E83",backgroundColor:"#fff",selectedColor:"#3c3e49",buttonColor:"#3c3e49",iconColor:"#fff"},content:[{iconPath:"/static/icon/location.png",selectedIconPath:"/static/icon/location-active.png",identify:"location",active:!1},{iconPath:"/static/icon/refresh.png",selectedIconPath:"/static/icon/refresh-active.png",identify:"refresh",active:!1}]},latitude:38.902037,longitude:-76.998016,covers:[]}),onLoad(){var t=this;R.watchPosition((function(i){t.sendLocation(i)}),(function(t){w.error(t)})),t.showLocation()},onShow(){this.initShowTimer()},onHide(){var t=this;t.showTimerId>0&&(clearTimeout(t.showTimerId),t.showTimerId=0)},methods:{initShowTimer:function(){this.showTimerId>0||this.showTimer()},showTimer:function(){var t=this;t.showTimerId=setTimeout((function(){t.showTimer(),t.getRegion()}),5e3)},trigger:function(t){for(var i=this,e=0;e<i.fab.content.length;e++)i.fab.content[e].identify==t.item.identify?i.fab.content[e].active=!0:i.fab.content[e].active=!1;"location"==t.item.identify?i.showLocation():"refresh"==t.item.identify&&T({url:"/pages/index/index"})},showLocation:function(){var t=this;t.showTimerId>0&&(clearTimeout(t.showTimerId),t.showTimerId=0),t.mapContext||(t.mapContext=C("map",t)),t.getLocation((function(i){t.latitude=i.latitude,t.longitude=i.longitude,t.mapContext.moveToLocation({latitude:t.latitude,longitude:t.longitude,success:function(i){t.scale=16,t.getRegion()},fail:function(){w.error("Located failed")}})}))},regionChange:function(t){var i=this;"end"==t.type&&(i.reginTimerId>0&&clearTimeout(i.reginTimerId),i.reginTimerId=setTimeout((function(){i.getRegion()}),1e3))},getRegion:function(t){var i=this;i.showTimerId>0&&(clearTimeout(i.showTimerId),i.showTimerId=0),i.mapContext||(i.mapContext=C("map",i)),i.mapContext.getRegion({success:function(t){_.post(v.getApi("coordinateList"),{southwest:t.southwest,northeast:t.northeast},(function(t){0!=t.code?i.showTimerId>0&&clearTimeout(i.showTimerId):(i.initShowTimer(),i.showMarkers(t.data))}),{"Content-Type":"application/json"})},fail:function(){w.error("Get Region Failed")}})},showMarkers:function(t){for(var i=[],e=0;e<t.bus.length;e++)i.push({id:1e5+t.bus[e].id,title:t.bus[e].user.username,desc:"school bus",latitude:t.bus[e].latitude,longitude:t.bus[e].longitude,iconPath:"/static/bus.png",width:50,height:50});for(var o=0;o<t.station.length;o++)i.push({id:2e5+t.station[o].id,title:t.station[o].title,desc:"bus station",latitude:t.station[o].latitude,longitude:t.station[o].longitude,iconPath:"/static/station.png",width:50,height:50});this.covers=i},getLocation:function(t){w.showLoading("Locating"),R.getCurrentPosition((function(i){w.hideLoading(),t(i)}),(function(t){w.hideLoading(),w.error(t)}))},sendLocation:function(t){var i=this;if(S().globalData.checkLogin())try{var e=x(S().globalData.loginTokenKey);if(e)JSON.parse(e).user.is_reporting&&_.post(v.getApi("coordinateReport"),{latitude:t.latitude,longitude:t.longitude},(function(t){0!=t.code&&(i.reportErrorShowTimers>=3?(i.reportErrorShowTimers=0,w.error("service unavaliable, report stop")):i.reportErrorShowTimers++)}),{"Content-Type":"application/json"})}catch(o){console.log(o)}},markertap:function(t){for(var i=this,e=t.detail.markerId,o=0;o<i.covers.length;o++){var s=JSON.parse(JSON.stringify(i.covers[o]));if(s.id==e){i.popupInfo={title:s.title,thumb:s.iconPath,note:s.desc},i.$refs.popup.open("top");break}}}}},[["render",function(t,o,n,a,l,u){const d=I,p=f,m=A(i("uni-fab"),D),g=A(i("uni-list-item"),$),y=A(i("uni-list"),B),b=A(i("uni-popup"),M);return e(),c(h,null,[r(p,{class:"container"},{default:s((()=>[r(d,{id:"map",latitude:l.latitude,longitude:l.longitude,markers:l.covers,scale:l.scale,"show-location":"true",onMarkertap:u.markertap,onRegionchange:u.regionChange},null,8,["latitude","longitude","markers","scale","onMarkertap","onRegionchange"])])),_:1}),r(m,{pattern:l.fab.pattern,content:l.fab.content,horizontal:"right",vertical:"bottom",direction:"vertical",onTrigger:u.trigger},null,8,["pattern","content","onTrigger"]),r(b,{ref:"popup",type:"bottom","background-color":"#ffffff"},{default:s((()=>[r(y,null,{default:s((()=>[r(g,{title:l.popupInfo.title,thumb:l.popupInfo.thumb,thumbSize:"lg",ellipsis:"1",note:l.popupInfo.note},null,8,["title","thumb","note"])])),_:1})])),_:1},512)],64)}],["__scopeId","data-v-6e455fe2"]]);export{j as default};
